<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ejemplo 2: Lectura y parseo de fichero CSV | nsyslog</title>
    <meta name="description" content="The next gen log agent">
    
    
    <link rel="preload" href="/assets/css/0.styles.79931b71.css" as="style"><link rel="preload" href="/assets/js/app.d04f700c.js" as="script"><link rel="preload" href="/assets/js/2.0a0974ea.js" as="script"><link rel="preload" href="/assets/js/97.24e79129.js" as="script"><link rel="prefetch" href="/assets/js/10.cc21cd78.js"><link rel="prefetch" href="/assets/js/100.8042dbd8.js"><link rel="prefetch" href="/assets/js/101.e4394c94.js"><link rel="prefetch" href="/assets/js/102.4ebdb0e6.js"><link rel="prefetch" href="/assets/js/103.11f93ace.js"><link rel="prefetch" href="/assets/js/104.65bc7467.js"><link rel="prefetch" href="/assets/js/105.0a96e7c2.js"><link rel="prefetch" href="/assets/js/106.7ca163d4.js"><link rel="prefetch" href="/assets/js/107.8d8e8bed.js"><link rel="prefetch" href="/assets/js/108.07fc35d8.js"><link rel="prefetch" href="/assets/js/109.fa7fb8cd.js"><link rel="prefetch" href="/assets/js/11.760564b4.js"><link rel="prefetch" href="/assets/js/110.dd1b2119.js"><link rel="prefetch" href="/assets/js/111.2e304ced.js"><link rel="prefetch" href="/assets/js/112.1cbdf716.js"><link rel="prefetch" href="/assets/js/113.37a2767d.js"><link rel="prefetch" href="/assets/js/114.f738c5b1.js"><link rel="prefetch" href="/assets/js/115.43cf8d2d.js"><link rel="prefetch" href="/assets/js/116.26ef97d9.js"><link rel="prefetch" href="/assets/js/117.be34c949.js"><link rel="prefetch" href="/assets/js/118.4ae22fe4.js"><link rel="prefetch" href="/assets/js/119.7bb09fcc.js"><link rel="prefetch" href="/assets/js/12.1c4aa260.js"><link rel="prefetch" href="/assets/js/120.4e84b9aa.js"><link rel="prefetch" href="/assets/js/121.1bf1c94a.js"><link rel="prefetch" href="/assets/js/122.a1716abe.js"><link rel="prefetch" href="/assets/js/123.bd208e78.js"><link rel="prefetch" href="/assets/js/124.ede79c2e.js"><link rel="prefetch" href="/assets/js/125.6c47fc4d.js"><link rel="prefetch" href="/assets/js/126.08f96afb.js"><link rel="prefetch" href="/assets/js/127.bc29f237.js"><link rel="prefetch" href="/assets/js/128.3e7b3470.js"><link rel="prefetch" href="/assets/js/129.d0b5b64a.js"><link rel="prefetch" href="/assets/js/13.24f98bcd.js"><link rel="prefetch" href="/assets/js/130.804c01d2.js"><link rel="prefetch" href="/assets/js/131.5cbc84c8.js"><link rel="prefetch" href="/assets/js/14.8d86445c.js"><link rel="prefetch" href="/assets/js/15.604b45cd.js"><link rel="prefetch" href="/assets/js/16.0e7e232f.js"><link rel="prefetch" href="/assets/js/17.296fab53.js"><link rel="prefetch" href="/assets/js/18.7daf704f.js"><link rel="prefetch" href="/assets/js/19.98fce78f.js"><link rel="prefetch" href="/assets/js/20.5e215926.js"><link rel="prefetch" href="/assets/js/21.6ff2317b.js"><link rel="prefetch" href="/assets/js/22.1979337e.js"><link rel="prefetch" href="/assets/js/23.c4a817e0.js"><link rel="prefetch" href="/assets/js/24.2529b9d6.js"><link rel="prefetch" href="/assets/js/25.ffc65e28.js"><link rel="prefetch" href="/assets/js/26.b5dbe787.js"><link rel="prefetch" href="/assets/js/27.b051af11.js"><link rel="prefetch" href="/assets/js/28.d1b53fb0.js"><link rel="prefetch" href="/assets/js/29.9663c935.js"><link rel="prefetch" href="/assets/js/3.6ff0db38.js"><link rel="prefetch" href="/assets/js/30.fcbabbc0.js"><link rel="prefetch" href="/assets/js/31.1c54bc05.js"><link rel="prefetch" href="/assets/js/32.63efe98a.js"><link rel="prefetch" href="/assets/js/33.ee6c5be7.js"><link rel="prefetch" href="/assets/js/34.bc0b8f82.js"><link rel="prefetch" href="/assets/js/35.94f0faa9.js"><link rel="prefetch" href="/assets/js/36.67954b6a.js"><link rel="prefetch" href="/assets/js/37.47c37103.js"><link rel="prefetch" href="/assets/js/38.c41a6189.js"><link rel="prefetch" href="/assets/js/39.3aeba2e0.js"><link rel="prefetch" href="/assets/js/4.3776f917.js"><link rel="prefetch" href="/assets/js/40.e8b09ab5.js"><link rel="prefetch" href="/assets/js/41.41934be5.js"><link rel="prefetch" href="/assets/js/42.fbb40a1c.js"><link rel="prefetch" href="/assets/js/43.48f182b6.js"><link rel="prefetch" href="/assets/js/44.8a76a581.js"><link rel="prefetch" href="/assets/js/45.8dba82d6.js"><link rel="prefetch" href="/assets/js/46.87e7da68.js"><link rel="prefetch" href="/assets/js/47.f6f3c963.js"><link rel="prefetch" href="/assets/js/48.5d08cddf.js"><link rel="prefetch" href="/assets/js/49.9549f8fe.js"><link rel="prefetch" href="/assets/js/5.51a688ed.js"><link rel="prefetch" href="/assets/js/50.d787969d.js"><link rel="prefetch" href="/assets/js/51.0f39607a.js"><link rel="prefetch" href="/assets/js/52.2cfd0516.js"><link rel="prefetch" href="/assets/js/53.0f81c618.js"><link rel="prefetch" href="/assets/js/54.a5458142.js"><link rel="prefetch" href="/assets/js/55.1a1ce62b.js"><link rel="prefetch" href="/assets/js/56.6ddffdb8.js"><link rel="prefetch" href="/assets/js/57.e3ecbe6e.js"><link rel="prefetch" href="/assets/js/58.f81c37e7.js"><link rel="prefetch" href="/assets/js/59.42d55ece.js"><link rel="prefetch" href="/assets/js/6.cec69a96.js"><link rel="prefetch" href="/assets/js/60.1bf734b1.js"><link rel="prefetch" href="/assets/js/61.dc91e6d1.js"><link rel="prefetch" href="/assets/js/62.e5702606.js"><link rel="prefetch" href="/assets/js/63.c775ca9a.js"><link rel="prefetch" href="/assets/js/64.3bf5660e.js"><link rel="prefetch" href="/assets/js/65.85ce678d.js"><link rel="prefetch" href="/assets/js/66.404531ba.js"><link rel="prefetch" href="/assets/js/67.867e3fb5.js"><link rel="prefetch" href="/assets/js/68.bd9c38e6.js"><link rel="prefetch" href="/assets/js/69.0c166981.js"><link rel="prefetch" href="/assets/js/7.fd4af81c.js"><link rel="prefetch" href="/assets/js/70.06491caa.js"><link rel="prefetch" href="/assets/js/71.ae6ae8d4.js"><link rel="prefetch" href="/assets/js/72.c3868aed.js"><link rel="prefetch" href="/assets/js/73.157c3cf8.js"><link rel="prefetch" href="/assets/js/74.49c5ebf4.js"><link rel="prefetch" href="/assets/js/75.c6830758.js"><link rel="prefetch" href="/assets/js/76.6dc33ef1.js"><link rel="prefetch" href="/assets/js/77.161deca2.js"><link rel="prefetch" href="/assets/js/78.c53fd341.js"><link rel="prefetch" href="/assets/js/79.d95cf045.js"><link rel="prefetch" href="/assets/js/8.492d61e1.js"><link rel="prefetch" href="/assets/js/80.b2a6c633.js"><link rel="prefetch" href="/assets/js/81.000acfff.js"><link rel="prefetch" href="/assets/js/82.bbe9c4eb.js"><link rel="prefetch" href="/assets/js/83.0d5315ee.js"><link rel="prefetch" href="/assets/js/84.502569d9.js"><link rel="prefetch" href="/assets/js/85.bbe761ec.js"><link rel="prefetch" href="/assets/js/86.df61e655.js"><link rel="prefetch" href="/assets/js/87.9270d7b4.js"><link rel="prefetch" href="/assets/js/88.755db401.js"><link rel="prefetch" href="/assets/js/89.fdd6fa92.js"><link rel="prefetch" href="/assets/js/9.da735a91.js"><link rel="prefetch" href="/assets/js/90.773b50de.js"><link rel="prefetch" href="/assets/js/91.f1d2906a.js"><link rel="prefetch" href="/assets/js/92.aa85a8a4.js"><link rel="prefetch" href="/assets/js/93.d4c011e2.js"><link rel="prefetch" href="/assets/js/94.d4eec923.js"><link rel="prefetch" href="/assets/js/95.0f35a902.js"><link rel="prefetch" href="/assets/js/96.be6f074c.js"><link rel="prefetch" href="/assets/js/98.c8eb8444.js"><link rel="prefetch" href="/assets/js/99.2367fe58.js">
    <link rel="stylesheet" href="/assets/css/0.styles.79931b71.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">nsyslog</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/intro/install.html" class="nav-link">Start</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/intro/basics.html" class="nav-link">Introduction</a></li><li class="dropdown-item"><!----> <a href="/config/main.html" class="nav-link">Configuration</a></li></ul></div></div><div class="nav-item"><a href="/jsdoc/index.html" class="nav-link">API docs</a></div><div class="nav-item"><a href="https://github.com/solzimer/nsyslog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/intro/example2.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/es/intro/example2.html" class="nav-link">Español</a></li></ul></div></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro/install.html" class="nav-link">Start</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/intro/basics.html" class="nav-link">Introduction</a></li><li class="dropdown-item"><!----> <a href="/config/main.html" class="nav-link">Configuration</a></li></ul></div></div><div class="nav-item"><a href="/jsdoc/index.html" class="nav-link">API docs</a></div><div class="nav-item"><a href="https://github.com/solzimer/nsyslog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/intro/example2.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/es/intro/example2.html" class="nav-link">Español</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/intro/install.html" class="sidebar-link">Installation</a></li><li><a href="/intro/basics.html" class="sidebar-link">Basics</a></li><li><a href="/intro/example1.html" class="sidebar-link">Ejemplo 1: Servidor de syslog</a></li><li><a href="/intro/example2.html" class="active sidebar-link">Ejemplo 2: Lectura y parseo de fichero CSV</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/intro/example2.html#logagent-json" class="sidebar-link">logagent.json</a></li><li class="sidebar-sub-header"><a href="/intro/example2.html#ejecucion" class="sidebar-link">Ejecución</a></li></ul></li><li><a href="/intro/commands.html" class="sidebar-link">Línea de comandos</a></li><li><a href="/intro/cli.html" class="sidebar-link">Modo CLI</a></li><li><a href="/intro/expressions.html" class="sidebar-link">Expresiones</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ejemplo-2-lectura-y-parseo-de-fichero-csv"><a href="#ejemplo-2-lectura-y-parseo-de-fichero-csv" aria-hidden="true" class="header-anchor">#</a> Ejemplo 2: Lectura y parseo de fichero CSV</h1> <p>El siguiente ejemplo consiste en leer un fichero en formato CSV, parsear su contenido, y almacenarlo en una colección de MongoDB:</p> <h2 id="logagent-json"><a href="#logagent-json" aria-hidden="true" class="header-anchor">#</a> logagent.json</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;inputs&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;csv_file&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;examples/config/data/csv002.csv&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;mode&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;watermark&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;offset&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;start&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token property">&quot;processors&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;parser&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;csvparser&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;input&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;${originalMessage}&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;output&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;fields&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;options&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;delimiter&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span>
					<span class="token property">&quot;columns&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token property">&quot;transporters&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;db_store&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mongo&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mongodb://localhost/nsyslog&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;collection&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;csvdata&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;format&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;${fields}&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token property">&quot;flows&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;csv_file&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;processors&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;parser&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;transporters&quot;</span><span class="token operator">:</span><span class="token string">&quot;db_store&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fuentes"><a href="#fuentes" aria-hidden="true" class="header-anchor">#</a> Fuentes</h3> <p>Se define una fuente de entrada en el apartado <strong>inputs</strong> :</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;inputs&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;csv_file&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;examples/config/data/csv002.csv&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;mode&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;watermark&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;offset&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;start&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Esta fuente, de tipo <a href="/inputs/file.html">file</a>, leerá un fichero CSV, línea a línea. Aunque en el enlace anterior se puede ver con más detalle el funcionamiento de las fuentes tipo <em>file</em>, veamos cual va a ser su comportamiento en este caso:</p> <ul><li><strong>path</strong>: Sólo queremos leer un determinado fichero, así que establecemos su ruta.</li> <li><strong>mode</strong>: Usamos el modo <em>watermark</em>; esto significa que la fuente irá almacenando en disco la posición de lectura, de forma que si reiniciamos nsyslog, la fuente recordará la posición previa y seguirá leyendo el fichero en el mismo punto donde se quedó.</li> <li><strong>offset</strong>: Desde dónde se empieza a leer un nuevo fichero. En este caso, desde el principio.</li></ul> <h3 id="procesadores"><a href="#procesadores" aria-hidden="true" class="header-anchor">#</a> Procesadores</h3> <p>A continuación se crea un procesador:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;processors&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;parser&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;csvparser&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;input&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;${originalMessage}&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;output&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;fields&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;options&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;delimiter&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span>
					<span class="token property">&quot;columns&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Este procesador, <strong>parser</strong>, de tipo <a href="/processors/csvparser.html">csvparser</a>, será el encargado de parsear líneas en formato CSV y transformarlas a objetos JSON. Su configuración es:</p> <ul><li><strong>input</strong>: Aquí se usa una <a href="/intro/expressions.html">expresión</a> para indicar que la línea está contenida en el campo <em>originalMessage</em> del dato de entrada.</li> <li><strong>output</strong>: El campo donde almacenar el resultado del parseo.</li> <li><strong>delimiter</strong>: Las columnas de una fila CSV están separadas por coma.</li> <li><strong>columns</strong>: Queremos que el resultado no sea un simple array de valores, sino un objeto completo cuyos atributos coincidan con los nombres de los campos de cada columna. Para ello, el parser usará la primera fila del fichero CSV para obtener los nombres de las columnas.</li></ul> <h3 id="transportes"><a href="#transportes" aria-hidden="true" class="header-anchor">#</a> Transportes</h3> <p>Se configura un transporte a MongoDB:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;transporters&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;db_store&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mongo&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mongodb://localhost/nsyslog&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;collection&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;csvdata&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;format&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;${fields}&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Dicho transporte <strong>db_store</strong>, de tipo <a href="/transporters/mongo.html">mongo</a>, escribirá el campo <em>fields</em> (donde están almacenados los valores de cada fila CSV) en una colección de MongoDB (csvdata).</p> <h3 id="flujo"><a href="#flujo" aria-hidden="true" class="header-anchor">#</a> Flujo</h3> <p>Por último, al igual que en el <a href="/intro/example1.html">Ejemplo 1</a>, se define el flujo:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;flows&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;csv_file&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;processors&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;parser&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;transporters&quot;</span><span class="token operator">:</span><span class="token string">&quot;db_store&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ejecucion"><a href="#ejecucion" aria-hidden="true" class="header-anchor">#</a> Ejecución</h2> <p>Puedes descargar el fichero CSV de ejemplo: <a href="/assets/csv002.csv">csv002.csv</a></p> <p>A continuación, ejecutamos nsyslog desde la línea de comandos:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>nsyslog -f logagent.json
</code></pre></div><p>Podemos comprobar como, en nuestra base de datos <strong>&quot;nsyslog&quot;</strong> de MongoDB, existe una colección llamada <strong>&quot;csvdata&quot;</strong> que contiene datos tal que:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ mongo
<span class="token operator">&gt;</span> use nsyslog
switched to db nsyslog
<span class="token operator">&gt;</span> show collections
csvdata
<span class="token operator">&gt;</span> db.csvdata.findOne<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	<span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5d93cc3f77d1b8f3768e9e5d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;32&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;workclass&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Federal-gov&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;fnlwgt&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;249409&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;education&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;HS-grad&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;education-num&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;9&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;marital-status&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Never-married&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;occupation&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Other-service&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;relationship&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Own-child&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;race&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Black&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;sex&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Male&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;capital-gain&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;capital-loss&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;hours-per-week&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;native-country&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;United-States&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;income&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;&lt;=50K&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/intro/example1.html" class="prev">
          Ejemplo 1: Servidor de syslog
        </a></span> <span class="next"><a href="/intro/commands.html">
          Línea de comandos
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.d04f700c.js" defer></script><script src="/assets/js/2.0a0974ea.js" defer></script><script src="/assets/js/97.24e79129.js" defer></script>
  </body>
</html>
